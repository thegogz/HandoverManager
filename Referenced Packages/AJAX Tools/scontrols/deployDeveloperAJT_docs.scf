<html>
<!--
Generated by AJAX tools
Date : Mon Dec 11 2006 22:24:07 GMT-0800 (Pacific Standard Time)
Template : simple.html by manoj@cheenath.com
Author : manoj
-->
<head>

<LINK REL="SHORTCUT ICON" HREF="/img/solutions_page_icon.gif">
<title>Document Browser</title>

<script src="/js/functions.js"></script>
<script src="/soap/ajax/10.0/connection.js"></script>

<script type="text/javascript">

    if (!sforce.connection.sessionId) {
        var sid = getCookie("sid");
        if (sid) {
            sforce.connection.sessionId = sid;
        } else {
            window.location = "/?startURL=" + window.location;
        }
    }

</script>

<script src="/js/dojo/0.4.1/dojo.js"></script>

<script>
    dojo.require("dojo.widget.ComboBox");
    dojo.require("dojo.widget.LayoutContainer");
    dojo.require("dojo.widget.ContentPane");
    dojo.require("dojo.widget.LinkPane");
    dojo.require("dojo.widget.SplitContainer");
    dojo.require("dojo.widget.ColorPalette");
    dojo.require("dojo.widget.TabContainer");
    dojo.require("dojo.widget.Tooltip");
    dojo.require("dojo.widget.Tree");
    dojo.require("dojo.widget.TreeSelector");
    dojo.require("dojo.event.*");
    dojo.require("dojo.lang.*");
    dojo.require("dojo.widget.*");
    dojo.require("dojo.widget.Dialog");
    dojo.require("dojo.widget.Select");
    //dojo.require("dojo.widget.ComboBox");
</script>

<script type="text/javascript">

    dojo.addOnLoad(init);
    var tree;
    var currentFrame;

    function init() {
        currentFrame = document.getElementById("text-area-frame");

        dojo.event.topic.subscribe("nodeSelected",
			 function(message) {
                 if (message.node.parentFolderNode) {
                     var folder = message.node.parentFolderNode;
                     tree.removeNode(message.node);
                     addDocumentNodes(folder);
                 } else if (message.node.docSobj) {
                     showDocument(message.node.docSobj);
                 }
             }
		);

        var tree_div = document.getElementById("tree-div");
        tree = dojo.widget.createWidget("Tree", {selector: "treeSelector"});

        var root = dojo.widget.createWidget("TreeNode",
        {title: "Documents"});
        root.expandLevel = 1;
        tree.addChild(root);
        tree_div.appendChild(tree.domNode);

        var query = "SELECT Id, Name, AccessType, IsReadonly, Type, CreatedDate, " +
                    "LastModifiedDate,SystemModstamp FROM Folder where type = 'Document'";

        var res = sforce.connection.query(query);

        var qit = new sforce.QueryResultIterator(res);

        while (qit.hasNext()) {
            var folder = qit.next();
            var folderNode = dojo.widget.createWidget("TreeNode",
            {title: folder.Name });

            folderNode.sobject = folder;
            root.addChild(folderNode);

            var sync = dojo.widget.createWidget("TreeNode",
            {title: "load document list ..." });
            sync.parentFolderNode = folderNode;
            folderNode.addChild(sync);
        }

        handleResize();
    }

    function addDocumentNodes(folder) {
        var sobj = folder.sobject;
        var query = "select id, name from document where folder.name = '" + sobj.Name + "'";
        var res = sforce.connection.query(query);
        var it = new sforce.QueryResultIterator(res);
        while(it.hasNext()) {
            var doc = it.next();
            var docNode = dojo.widget.createWidget("TreeNode", {title: doc.Name });
            docNode.docSobj = doc;
            folder.addChild(docNode);
        }
    }

    function showDocument(doc) {
        currentFrame.src = "/servlet/servlet.FileDownload?file=" + doc.Id;
        /*
        dojo.io.bind({
          url: "/servlet/servlet.FileDownload?file=" + doc.Id,
          load: loadDocument});
          */
    }

    function loadDocument(type, data, event) {
      var document_ta = document.getElementById("document-ta");
      document_ta.value = data;
    }

    function handleResize() {
        var iframe = document.getElementById('text-area-frame');
        //var list = document.getElementById('open-message');
        if (window.innerHeight) {
            //ff
            iframe.height = window.innerHeight - 200;
            //list.style.height = (window.innerHeight - 200) + "px";
        } else {
            //ie
            iframe.height = document.documentElement.clientHeight - 200;
            //var h = Math.max(600, document.body.offsetHeight);
            //iframe.height = h - 150;
        }
    }

    function refreshDocs() {
        window.location.reload();
        //tree.destroy();
        //document.getElementById("tree-div").innerHTML = "";
        //currentFrame.src = "";
        //init();
    }

    function showHelp() {
        window.open("https://wiki.apexdevnet.com/index.php/Ajax_Tools");
    }
</script>

<style>

    .dojoDialog {
        background: #eee;
        border: 1px solid #999;
        -moz-border-radius: 5px;
        padding: 4px;
    }

        /*
        html, body {
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 0 0 0 0;
            margin: 0 0 0 0;
        }*/

    img {
        border: 0;
    }

    .dojoSplitPane {
        margin: 5px;
    }

    #rightPane {
        margin: 0;
    }

    TABLE {
        border-collapse: collapse;
        border: 1px solid black;
        font-size: 12px;
    }

    *#col1 {
        border: 3px solid black;
    }

    TD {
        border: 1px dotted green;
        padding: .25em;
    }

    TD.solid-blue {
        border: 5px dashed blue;
    }

    TD.dotted-black {
        border: 0px dotted black;
        padding: 10px;
    }

    TD.solid-green {
        border: 5px solid green;
    }
</style>

</head>
<body onresize="handleResize()">

<table height="100%" width="100%">
    <tr>
        <td colspan=2 valign="top">
            <table width="100%">
                <tr>
                    <td class="dotted-black" width=30>
                        <a href="javascript:refreshDocs(); void 0;">
                            <img src="/img/recurring_activity.gif" width="24" height="24" alt="User"></img></a><br>Refresh
                    </td>

                    <td class="dotted-black" width=30>
                        <a href="javascript:showHelp(); void 0">
                            <img src="/img/help/helpTips_icon.gif" width="24" id="help-tip" height="24" alt="Help"></img></a><br>Help
                         <span dojoType="tooltip" style="display: none;" connectId="help-tip">Open Help window</span>
                    </td>

                    <td class="dotted-black">
                        <a href="mailto:ajaxtools@cheenath.com?Subject=Document-Browser-bug">
                            <img src="/img/icon_warning.gif" width="24" height="24" alt="Bug"></img></a><br>Bug
                    </td>
                    <td width=100% class="dotted-black">&nbsp;</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr valign="top" height="100%">
        <td valign="top">
            <dojo:TreeSelector widgetId="treeSelector" eventNames="select:nodeSelected"></dojo:TreeSelector>
            <div>
                <div id="tree-div" style="overflow: hidden;"></div>
            </div>
        </td>
        <td valign="top" width="70%">
            <div id="result-div">
                <h3>Document Browser</h3>
                <iframe  title="text-area-frame" hight="100%" width="100%" align="top"
                        frameborder="0" scorolling="no" id="text-area-frame"
                        name="text-area-frame"></iframe>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan=2>
            <div style="background-color: #274383; color: white;"> Status:</div>
        </td>
    </tr>
</table>

</body>
</html>